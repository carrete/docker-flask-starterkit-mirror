#!/usr/bin/env bash
# -*- mode: sh; coding: utf-8; tab-width: 4; indent-tabs-mode: nil -*-
set -euo pipefail
IFS=$'\n\t'

. /var/cache/starterkit/environment

echo "$GITLAB_PASSWORD" | sudo docker login --password-stdin -u "$GITLAB_USERNAME" $REGISTRY

readonly SERVICES="
    prune-docker-images.timer
    create-network.service
    flask-app.service
    create-default-site.service
    create-htpasswd.service
    create-snakeoil-cert.service
    nginx-proxy-unit.service
"

sudo systemctl daemon-reload
echo $SERVICES | xargs sudo systemctl enable

exit 0
